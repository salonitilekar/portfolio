---
import Menu from "@icons/Menu.astro";
import ThemeToggle from "./ThemeToggle.astro";
import type { HeaderProps } from "@types";

type Props = HeaderProps;

const { siteLogo, navLinks } = Astro.props;
---

<header
  class="sticky top-0 z-50 w-full animate-slide-in border-b border-neutral/20 px-5 py-6"
  style="backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); background-color: var(--navbar-glass-bg);"
>
  <div class="mx-auto max-w-5xl relative flex items-center">
    <!-- Left: Home Icon -->
    <a href="/" aria-label="Home link" class="absolute left-0">
      <svg 
        width="22" 
        height="22" 
        viewBox="0 0 24 24" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="2" 
        stroke-linecap="round" 
        stroke-linejoin="round"
        style="color: var(--navbar-text);"
        class="transition-colors duration-200 hover:scale-110"
      >
        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
        <polyline points="9,22 9,12 15,12 15,22"/>
      </svg>
    </a>

    <!-- Center: Navigation -->
    <div class="flex items-center gap-6 mx-auto">
      <ThemeToggle />
      
      <nav
        class="hidden sm:block"
        id="main-menu"
      >
        <ul class="flex gap-6">
          {
            navLinks.map((link) => (
              <li class="relative">
                <a
                  class="nav-item relative block p-2 text-sm font-medium transition-all duration-500 after:absolute after:bottom-0 after:left-2/4 after:h-2 after:w-1 after:-translate-x-2/4 after:opacity-0 after:content-['•']"
                  style="color: var(--navbar-text); --tw-after-text-opacity: 1; --tw-after-color: var(--color-primary);"
                  href={link.href}
                  target={link.target}
                  rel={link.target === "_blank" ? "noopener noreferrer" : undefined}
                >
                  {link.text}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>

    <!-- Right: Social Icons (desktop only) -->
    <div class="absolute right-0 flex items-center gap-4">
      <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn" class="hidden sm:inline-block">
        <!-- LinkedIn SVG -->
        <svg width="22" height="22" viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="color: var(--navbar-text);">
          <path d="M28.778 1.004h-25.56c-0.008-0-0.017-0-0.027-0-1.199 0-2.172 0.964-2.186 2.159v25.672c0.014 1.196 0.987 2.161 2.186 2.161 0.010 0 0.019-0 0.029-0h25.555c0.008 0 0.018 0 0.028 0 1.2 0 2.175-0.963 2.194-2.159l0-0.002v-25.67c-0.019-1.197-0.994-2.161-2.195-2.161-0.010 0-0.019 0-0.029 0h0.001zM9.9 26.562h-4.454v-14.311h4.454zM7.674 10.293c-1.425 0-2.579-1.155-2.579-2.579s1.155-2.579 2.579-2.579c1.424 0 2.579 1.154 2.579 2.578v0c0 0.001 0 0.002 0 0.004 0 1.423-1.154 2.577-2.577 2.577-0.001 0-0.002 0-0.003 0h0zM26.556 26.562h-4.441v-6.959c0-1.66-0.034-3.795-2.314-3.795-2.316 0-2.669 1.806-2.669 3.673v7.082h-4.441v-14.311h4.266v1.951h0.058c0.828-1.395 2.326-2.315 4.039-2.315 0.061 0 0.121 0.001 0.181 0.003l-0.009-0c4.5 0 5.332 2.962 5.332 6.817v7.855z"/>
        </svg>
      </a>
      <a href="https://github.com" target="_blank" aria-label="GitHub" class="hidden sm:inline-block">
        <!-- Font Awesome GitHub Octocat SVG -->
        <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" style="color: var(--navbar-text);"><path fill="currentColor" d="M12 0C5.371 0 0 5.371 0 12c0 5.303 3.438 9.8 8.205 11.387.6.111.82-.261.82-.577 0-.285-.011-1.04-.017-2.04-3.338.726-4.042-1.611-4.042-1.611-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.84 1.237 1.84 1.237 1.07 1.834 2.809 1.304 3.495.997.108-.775.418-1.304.762-1.604-2.665-.304-5.466-1.334-5.466-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.553 3.297-1.23 3.297-1.23.653 1.653.242 2.873.118 3.176.77.84 1.235 1.91 1.235 3.221 0 4.609-2.803 5.624-5.475 5.921.43.371.823 1.102.823 2.222 0 1.604-.015 2.896-.015 3.286 0 .319.216.694.825.576C20.565 21.796 24 17.299 24 12c0-6.629-5.371-12-12-12z"/></svg>
      </a>
      <a href="https://twitter.com" target="_blank" aria-label="X" class="hidden sm:inline-block">
        <!-- Official X (Twitter) SVG from X Brand Toolkit -->
        <svg width="22" height="22" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: var(--navbar-text);"><rect width="120" height="120" fill="none"/><path d="M93.5 26H110L76.5 62.5L115 114H83.5L59.5 83.5L32.5 114H16L52.5 74.5L15 26H47L68.5 54L93.5 26ZM87.5 106H97.5L41.5 34H31.5L87.5 106Z" fill="currentColor"/></svg>
      </a>
      <a href="https://youtube.com" target="_blank" aria-label="YouTube" class="hidden sm:inline-block">
        <!-- Font Awesome YouTube SVG -->
        <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" class="svg-inline--fa fa-youtube" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="22" height="22" style="color: var(--navbar-text);"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.84-42.21-48.48-48.48C465.5 64 288 64 288 64s-177.5 0-213.175 11.603c-23.64 6.27-42.199 24.83-48.48 48.48C16 159.759 16 256 16 256s0 96.241 10.345 131.917c6.281 23.65 24.84 42.21 48.48 48.48C110.5 448 288 448 288 448s177.5 0 213.175-11.603c23.64-6.27 42.199-24.83 48.48-48.48C560 352.241 560 256 560 256s0-96.241-10.345-131.917zM232 336V176l142.745 80L232 336z"/></svg>
      </a>
      <a href="https://devpost.com" target="_blank" aria-label="Devpost" class="hidden sm:inline-block">
        <!-- Devpost SVG -->
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="color: var(--navbar-text);">
          <path d="M6.002 1.61 0 12.004 6.002 22.39h11.996L24 12.004 17.998 1.61zm1.593 4.084h3.947c3.605 0 6.276 1.695 6.276 6.31 0 4.436-3.21 6.302-6.456 6.302H7.595zm2.517 2.449v7.714h1.241c2.646 0 3.862-1.55 3.862-3.861.009-2.569-1.096-3.853-3.767-3.853z"/>
        </svg>
      </a>
    </div>

    <!-- Right: Mobile Menu Button -->
    <button
      type="button"
      id="menu-button"
      class="absolute right-0 px-1.5 transition-colors sm:hidden"
      style="color: var(--navbar-text);"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <Menu />
    </button>
  </div>

  <!-- Mobile menu -->
  <nav
    class="absolute top-20 right-5 hidden rounded-xl border border-neutral/40 backdrop-blur-sm px-4 py-5 sm:hidden"
    id="mobile-menu"
    style="background-color: var(--color-bg); color: var(--color-neutral);"
  >
    <ul class="gap-2">
      {
        navLinks.map((link) => (
          <li class="relative">
            <a
              class="nav-item relative block p-2 text-sm font-medium transition-all duration-500 after:absolute after:bottom-0 after:left-2/4 after:h-2 after:w-1 after:-translate-x-2/4 after:opacity-0 after:content-['•']"
              style="color: var(--color-neutral); --tw-after-text-opacity: 1; --tw-after-color: var(--color-primary);"
              href={link.href}
              target={link.target}
              rel={link.target === "_blank" ? "noopener noreferrer" : undefined}
            >
              {link.text}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
</header>

<script>
  // Toggle mobile menu
  const button = document.querySelector("#menu-button");
  const mobileMenu = document.querySelector("#mobile-menu");
  const navItems = document.querySelectorAll("#main-menu > ul > li > a, #mobile-menu > ul > li > a");

  const toggleMenu = () => {
    mobileMenu?.classList.toggle("hidden");
    const isHidden = mobileMenu?.classList.contains("hidden");
    button?.setAttribute("aria-expanded", `${!isHidden}`);
  };

  button?.addEventListener("click", toggleMenu);
  navItems.forEach((item) => {
    item?.addEventListener("click", toggleMenu);
  });

  // Update navigation based on scroll position with Intersection Observer
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          navItems.forEach((item) => {
            const navItem = item as HTMLElement;
            if (item.getAttribute("href") === `#${entry.target.id}`) {
              navItem.style.color = 'var(--color-text)';
              navItem.style.setProperty('--tw-after-opacity', '1');
            } else {
              navItem.style.color = 'var(--color-neutral)';
              navItem.style.setProperty('--tw-after-opacity', '0');
            }
          });
        }
      });
    },
    { threshold: 0.5 },
  );

  document.querySelectorAll("section").forEach((section) => {
    observer.observe(section);
  });

  // Cleanup observer
  document.onvisibilitychange = () => {
    if (document.visibilityState === "hidden") {
      observer.disconnect();
    } else {
      document.querySelectorAll("section").forEach((section) => {
        observer.observe(section);
      });
    }
  };
</script>

<style>
  header {
    animation-timeline: scroll();
    animation-range: 0 650px;
  }
</style>
